<div class="todo-container">
  <h1>Todos</h1>
  <div *ngIf="error" class="error">{{ error }}</div>

  <form [formGroup]="todoForm" (ngSubmit)="onSubmit()" class="todo-form">
    <input
      type="text"
      formControlName="taskName"
      placeholder="What needs to be done?"
      required
    />
    <input
      type="datetime-local"
      formControlName="deadline"
      title="Set a deadline"
    />
    <button type="submit" [disabled]="todoForm.invalid">Add</button>
  </form>

  <div *ngIf="loading" class="loading">Loading your todos...</div>

  <div *ngIf="!loading">
    <div *ngIf="filteredTodos.length === 0" class="empty-state">
      <div>No todos yet!</div>
    </div>

    <div *ngIf="filteredTodos.length > 0" class="todo-list">
      <div
        *ngFor="let todo of filteredTodos"
        class="todo-item"
        [class.overdue]="isOverdue(todo)"
        [class.done]="todo.done"
      >
        <input
          type="checkbox"
          class="todo-checkbox"
          [checked]="todo.done"
          (change)="handleDoneToggle(todo.id)"
          [title]="todo.done ? 'Mark as incomplete' : 'Mark as complete'"
        />
        <div class="todo-content">
          <div class="todo-title">{{ todo.taskName }}</div>
          <div class="todo-deadline">
            {{ todo.deadline ? 'ğŸ“… ' + (todo.deadline | date:'medium') : 'ğŸ“… No deadline' }}
          </div>
        </div>
        <div class="todo-actions">
          <button
            class="delete-btn"
            (click)="handleDelete(todo.id)"
            title="Delete todo"
          >
            ğŸ—‘ï¸
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="todos.length > 0" class="footer">
      <span>
        {{ itemsLeft }} item{{ itemsLeft !== 1 ? 's' : '' }} left.
      </span>
      <div class="filters">
        <button
          (click)="filter = 'all'"
          [class.active]="filter === 'all'"
        >
          All
        </button>
        <button
          (click)="filter = 'active'"
          [class.active]="filter === 'active'"
        >
          Active
        </button>
        <button
          (click)="filter = 'completed'"
          [class.active]="filter === 'completed'"
        >
          Completed
        </button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="deleteId" class="confirm-dialog-overlay">
  <div class="confirm-dialog">
    <h3>Delete Todo</h3>
    <p>Are you sure you want to delete this todo?</p>
    <div class="confirm-dialog-actions">
      <button (click)="handleCancelDelete()" class="cancel-btn">
        Cancel
      </button>
      <button (click)="handleConfirmDelete()" class="confirm-btn">
        Delete
      </button>
    </div>
  </div>
</div>